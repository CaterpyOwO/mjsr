(()=>{"use strict";var __webpack_modules__={274:(e,t,r)=>{class i{constructor(e=[0,0,0],t=[0,0,0],r=6){return this.pos=e,this.rot=t,this.fov=100*r,this}projectVertex2d(e,t){let[r,i,s]=e;r-=this.pos[0],i-=this.pos[1],s-=this.pos[2],[r,s]=this.rotateVertex2d([r,s],this.rot[1]),[i,s]=this.rotateVertex2d([i,s],this.rot[0]);let o=this.fov/Math.max(0,s);return r*=o,i*=o,[r+t.width/2,i+t.height/2,s]}rotateVertex2d(e,t){let[r,i]=e,s=Math.sin(t),o=Math.cos(t);return[r*o-i*s,i*o+r*s]}}class s{constructor(e={width:640,height:480},t=document.body,r){return r instanceof HTMLCanvasElement?this.canvas=r:this.canvas=document.createElement("canvas"),this.canvas.width=e.width,this.canvas.height=e.height,this.gl=this.canvas.getContext("webgl"),this.parent=t,t instanceof HTMLElement&&t.appendChild(this.canvas),this}fullscreen(){this.canvas.width=innerWidth,this.canvas.height=innerHeight,window.addEventListener("resize",(()=>{this.canvas.width=innerWidth,this.canvas.height=innerHeight}));let e=document.createElement("style");return e.innerText="html,body{margin:0;overflow:hidden}",document.head.appendChild(e),this}fillParent(){return this.canvas.width=this.parent.clientWidth,this.canvas.height=this.parent.clientHeight,window.addEventListener("resize",(()=>{this.canvas.width=this.parent.clientWidth,this.canvas.height=this.parent.clientHeight})),this}square(e){return this.canvas.width=e,this.canvas.height=e,this}rect(e,t){return this.canvas.width=e,this.canvas.height=t,this}}const o={None:class{update(){}setAttributes(){}setupMovement(){}},FirstPerson:class{constructor(){this.keys=[]}setAttributes(e,t){this.screen=e,this.camera=t}setupMovement(){let{canvas:e}=this.screen;window.addEventListener("keydown",(e=>this.keys[e.key.toLowerCase()]=!0)),window.addEventListener("keyup",(e=>this.keys[e.key.toLowerCase()]=!1));let t=e=>Math.abs(e.movementX)>50||Math.abs(e.movementY)>50?void 0:this.mouseRotation([e.movementX,e.movementY]);e.requestPointerLock=e.requestPointerLock||e.mozRequestPointerLock,document.exitPointerLock=document.exitPointerLock||document.mozExitPointerLock,e.onclick=()=>e.requestPointerLock();let r=()=>{document.pointerLockElement===e||document.mozPointerLockElement===e?e.onmousemove=t:e.onmousemove=null};document.addEventListener("pointerlockchange",r),document.addEventListener("mozpointerlockchange",r)}mouseRotation(e,t=3){let[r,i]=e;r/=t*=100,i/=t,this.camera.rot[0]+i<Math.PI/2&&this.camera.rot[0]+i>-Math.PI/2&&(this.camera.rot[0]+=i),this.camera.rot[1]+=r}update(e){let{canvas:t}=this.screen;if(document.pointerLockElement==t||document.mozPointerLockElement==t){let t=e/160;(this.keys.q||this.keys[" "])&&(this.camera.pos[1]+=t),(this.keys.e||this.keys.Shift)&&(this.camera.pos[1]-=t);let r=t*Math.sin(this.camera.rot[1]),i=t*Math.cos(this.camera.rot[1]);this.keys.w&&(this.camera.pos[0]-=r,this.camera.pos[2]-=i),this.keys.s&&(this.camera.pos[0]+=r,this.camera.pos[2]+=i),this.keys.a&&(this.camera.pos[0]+=i,this.camera.pos[2]-=r),this.keys.d&&(this.camera.pos[0]-=i,this.camera.pos[2]+=r)}}},ModelRotate:class{constructor(){this.keys=[]}setAttributes(e,t){this.screen=e,this.camera=t}setupMovement(){let{canvas:e}=this.screen,t=[0,0];const r=e=>this.mouseRotation([e.movementX,e.movementY]);e.onmousedown=()=>e.onmousemove=r,window.onmouseup=()=>e.onmousemove=null,e.addEventListener("touchstart",(e=>t=[e.touches[0].screenX,e.touches[0].screenY]),{passive:!0}),e.addEventListener("touchmove",(e=>(this.mouseRotation([-(t[0]-e.touches[0].screenX),t[1]-e.touches[0].screenY]),t=[e.touches[0].screenX,e.touches[0].screenY])),{passive:!0}),e.addEventListener("touchend",(()=>(e.ontouchmove=null,t=[0,0])))}mouseRotation(e){let{pos:t}=this.camera;e[0]*=.01,this.camera.pos=this.rotate2d(t,-e[0],[0,2]),this.camera.rot[1]+=e[0]}rotate2d(e,t,r){let[i,s]=r,[o,n]=[e[i],e[s]],a=Math.sin(t),h=Math.cos(t);return e[i]=o*h-n*a,e[s]=n*h+o*a,e}update(){}}};function n(e){let t=[e[1][0]-e[0][0],e[1][1]-e[0][1],e[1][2]-e[0][2]],r=[e[2][0]-e[0][0],e[2][1]-e[0][1],e[2][2]-e[0][2]];return function(e){let t=Math.sqrt(e[0]**2+e[1]**2+e[2]**2);return[e[0]/=t,e[1]/=t,e[2]/=t]}([t[1]*r[2]-t[2]*r[1],t[2]*r[0]-t[0]*r[2],t[0]*r[1]-t[1]*r[0]])}function a(e){if("#"==!e.charAt(0))throw new Error(e+" is not a HEX colour.");return[...(e=3==(e=e.substr(1)).length?e.split("").reduce(((e,t)=>e.push(t+t)&&e),[]):e.match(/.{1,2}/g)).map((e=>{return t=parseInt(e,16)/255,0,1,Math.max(Math.min(t,1),0);var t})),1]}class h{constructor(e){return this.gl=e,this.shaders=[],this.glprogram=null,this}frag(e){this.shader(e,this.gl.FRAGMENT_SHADER)}vert(e){this.shader(e,this.gl.VERTEX_SHADER)}shader(e,t){if(e=e.raw?e.raw.join(""):e,!t){let r=new RegExp("// ?vert(ex)?( |_|-)shader","i"),i=new RegExp("// ?frag(ment)?( |_|-)shader","i");if(r.test(e))t=this.gl.VERTEX_SHADER;else{if(!i.test(e))throw new Error("No shader type found.");t=this.gl.FRAGMENT_SHADER}}let r=this.gl.createShader(t);if(this.gl.shaderSource(r,e),this.gl.compileShader(r),this.gl.getShaderParameter(r,this.gl.COMPILE_STATUS))return this.shaders.push(r),r;let i=new Error(this.gl.getShaderInfoLog(r));throw this.gl.deleteShader(r),i}program(...e){if(0==e.length&&(e=this.shaders),0==e.length)throw new Error("No shaders were supplied.");let t=this.gl.createProgram();for(let r of e)this.gl.attachShader(t,r);if(this.gl.linkProgram(t),this.gl.getProgramParameter(t,this.gl.LINK_STATUS))return this.glprogram=t,t;let r=new Error(this.gl.getProgramInfoLog(t));throw this.gl.deleteProgram(t),r}buffers(e,t){if(0==e.length)throw new Error("No buffers were supplied.");for(let r in e){let i=e[r];this.buffer32f(i,this.gl.ARRAY_BUFFER);let s=this.gl.getAttribLocation(this.glprogram,r);this.gl.enableVertexAttribArray(s),t[r]?this.gl.vertexAttribPointer(s,t[r],this.gl.FLOAT,!1,0,0):this.gl.vertexAttribPointer(s,3,this.gl.FLOAT,!1,0,0)}}buffer32f(e,t){let r=this._bufferInit(t);return this.gl.bufferData(t,new Float32Array(e),this.gl.STATIC_DRAW),r}buffer16u(e,t){let r=this._bufferInit(t);return this.gl.bufferData(t,new Uint16Array(e),this.gl.STATIC_DRAW),r}buffer32u(e,t){let r=this._bufferInit(t);return this.gl.bufferData(t,new Uint32Array(e),this.gl.STATIC_DRAW),r}_bufferInit(e){const t=this.gl.createBuffer();return this.gl.bindBuffer(e,t),t}}var c=r(930);function l(e={primitive:2,lighting:!0}){return(0,c.d)("\n    precision mediump float;\n\n    attribute vec4 position;\n    attribute vec4 colour;\n    attribute vec4 normal;\n\n    varying vec4 v_colour;\n    varying vec4 v_normal;\n\n    \nuniform vec3 u_pos;\nuniform vec3 u_rot;\n\nuniform vec2 u_canvas;\t\n\nvec2 rotate2d(vec2 pos, float rad) {\n    float s = sin(rad);\n    float c = cos(rad);\n\n    return vec2(pos.x * c - pos.y * s, pos.y * c + pos.x * s);\n}\n\nvec3 project(vec3 vertex) {\n    vertex.x -= u_pos.x;\n    vertex.y -= u_pos.y;\n    vertex.z -= u_pos.z;\n    \n    vertex.xz = rotate2d(vertex.xz, u_rot.y);\n    vertex.yz = rotate2d(vertex.yz, u_rot.x);\n    \n    float f = 600.0 / max(0.0, vertex.z);\n    vertex.x *= f;\n    vertex.y *= f;\n\n    return vec3(vertex.x / u_canvas.x * 2.0, -(vertex.y / u_canvas.y * 2.0), vertex.z / 1000.0);\n}\n\n    #if (options.lighting)\n        varying vec3 v_surfaceLight; \n        vec4 light = vec4(0.0, 5.0, 5.0, 1.0);\n    #endif\n\n\n    void main() {\n        v_colour = colour;\n\n        #if (options.primitive == 2 && options.lighting) \n            v_surfaceLight = light.xyz - position.xyz;\n            v_normal = normal;\n        #endif\n\n        #if (options.primitive == 0)\n            gl_PointSize = 5.0;\n        #endif\n\n        vec3 projected = project(position.xyz);\n        gl_Position = vec4(projected.xyz, 1.0);\n    }\n    ",e)}function u(e={primitive:2,lighting:!0,mono:!1}){return(0,c.d)("\nprecision mediump float;\n\nvarying vec4 v_normal;\nvarying vec4 v_colour;\n\n#if options.lighting\n\tvarying vec3 v_surfaceLight;\n\tvec4 lightd = vec4(0.0, 5.0, 5.0, 1.0);\n#endif\n\nvoid main() {\n\t#if options.mono\n\t\t\nfloat lum = (v_colour.r + v_colour.g + v_colour.b) / 3.0;\nvec2 monoColour = vec2(lum, v_colour.a);\n\ngl_FragColor = monoColour.xxxy;\n\t#else\n\t\tgl_FragColor = v_colour;\n\t#endif\n\n\t#if options.lighting\n\t\tfloat light = dot(normalize(v_normal.xyz), normalize(v_surfaceLight));\n\t\tgl_FragColor.rgb *= clamp(light, 0.3, 1.0);\n\t#endif\n}",e)}e=r.hmd(e);const p={Renderer:class{constructor(e=new s,t=new i,r=new o.None){return this.screen=e,this.camera=t,r.setAttributes(e,t),this.input=r,this.dt=0,this.last=0,this}setup(e){this.scene=e,this.meshes=[],this.primitives=new Set,this.shaders={};for(let e of this.scene){if("object"!=typeof e)throw new Error("Invalid object in scene.");const t={0:["coords","verts","colours","primitive"],1:["coords","verts","edges","colours","primitive"],2:["coords","verts","faces","colours","primitive"]},r=["points","lines","triangles"];let i;if("string"!=typeof e.primitive||void 0===r.includes(e.primitive))throw new Error("No primitive type supplied.");i=r.indexOf(e.primitive);for(let r of t[i])if(void 0===e[r])throw new Error(`Object doesn't have required property ${r}.`);let s={position:[],colour:[],normal:[],primitive:i};switch(i){case 0:for(let t of e.verts){let r=a(e.colours[t[3]]);s.position.push(t[0],t[1],t[2]),s.colour.push(...r)}break;case 1:for(let t of e.edges){let r=a(e.colours[t[2]]);s.position.push(...e.verts[t[1]],...e.verts[t[0]]),s.colour.push(...r,...r)}break;case 2:for(let t of e.faces){let r=n([e.verts[t[0]],e.verts[t[1]],e.verts[t[2]]]),i=a(e.colours[t[3]]);s.position.push(...e.verts[t[2]],...e.verts[t[1]],...e.verts[t[0]]),s.colour.push(...i,...i,...i),s.normal.push(...r,...r,...r)}}this.primitives.add(i),this.meshes.push(s)}const{gl:t}=this.screen;for(let e of this.primitives){let r=new h(t),i=2==e;r.vert(l({lighting:i,primitive:e})),r.frag(u({lighting:i,primitive:e,mono:!1})),r.program(),this.shaders[e]=r}t.clearColor(1,1,1,1),t.enable(t.DEPTH_TEST),t.enable(t.CULL_FACE),this.input.setupMovement()}draw(){const{gl:e}=this.screen;let t=[e.POINTS,e.LINES,e.TRIANGLES];e.viewport(0,0,e.drawingBufferWidth,e.drawingBufferHeight),e.clear(e.COLOR_BUFFER_BIT|e.DEPTH_BUFFER_BIT);for(let t in this.shaders){let r=this.shaders[t];e.useProgram(r.glprogram),e.uniform3fv(e.getUniformLocation(r.glprogram,"u_pos"),this.camera.pos),e.uniform3fv(e.getUniformLocation(r.glprogram,"u_rot"),this.camera.rot),e.uniform2fv(e.getUniformLocation(r.glprogram,"u_canvas"),[e.drawingBufferWidth,e.drawingBufferHeight]),e.useProgram(null)}for(let r of this.meshes){const i=r.primitive,s=this.shaders[i];e.useProgram(s.glprogram);let o={position:r.position,colour:r.colour};2==r.primitive&&(o.normal=r.normal),s.buffers(o,{colour:4}),e.drawArrays(t[i],0,r.position.length/(i+1)),e.useProgram(null)}}update(e){this.dt=this.last-e,this.last=e,this.input.update(this.dt)}},Screen:s,Camera:i,Input:o,Geometry:{Cube:class{constructor(e=[0,0,0]){let[t,r,i]=e;this.coords=e,this.primitive="triangles",this.verts=[[t-1,r-1,i-1],[t+1,r-1,i-1],[t+1,r+1,i-1],[t-1,r+1,i-1],[t-1,r-1,i+1],[t+1,r-1,i+1],[t+1,r+1,i+1],[t-1,r+1,i+1]],this.edges=[[0,1],[1,2],[2,3],[3,0],[4,5],[5,6],[6,7],[7,4],[0,4],[1,5],[2,6],[3,7]],this.faces=[[0,1,2,0],[2,3,0,0],[1,5,6,1],[6,2,1,1],[4,5,1,2],[1,0,4,2],[6,5,4,3],[4,7,6,3],[7,4,0,4],[0,3,7,4],[2,6,7,5],[7,3,2,5]],this.colours=["#0ff","#0f0","#f0f","#00f","#ff0","#f00"]}},Plane:class{constructor(e=[0,0,0]){this.coords=e;let[t,r,i]=e;this.primitive="triangles",this.verts=[[t-1,r,i-1],[t-1,r,i+1],[t+1,r,i+1],[t+1,r,i-1]],this.faces=[[0,1,2,0],[2,3,0,0],[2,1,0,1],[0,3,2,1]],this.colours=["#faf","#aff"]}}}};"function"==typeof define&&r.amdO?define([],(()=>p)):"object"==typeof exports?e.exports=p:window.mjsr=p},930:(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{function preprocess(source,options){function traverse(lines,condition=!0){let output="";for(let l in lines){let line=lines[l].trim();switch(line.split(/\s/)[0]){case"#if":lines.splice(0,parseInt(l)+1),output+=traverse(lines,eval(line.substr(3).trim()));break;case"#else":lines.splice(0,parseInt(l)+1),output+=traverse(lines,!condition);break;case"#endif":lines.splice(0,parseInt(l)+1),output+=traverse(lines,!0);break;default:condition&&(output+=line+"\n")}}return output.trim()}return source+="\n#endif\n",traverse(source.split(/\n/))}__webpack_require__.d(__webpack_exports__,{d:()=>preprocess})}},__webpack_module_cache__={};function __webpack_require__(e){if(__webpack_module_cache__[e])return __webpack_module_cache__[e].exports;var t=__webpack_module_cache__[e]={id:e,loaded:!1,exports:{}};return __webpack_modules__[e](t,t.exports,__webpack_require__),t.loaded=!0,t.exports}__webpack_require__.amdO={},__webpack_require__.d=(e,t)=>{for(var r in t)__webpack_require__.o(t,r)&&!__webpack_require__.o(e,r)&&Object.defineProperty(e,r,{enumerable:!0,get:t[r]})},__webpack_require__.hmd=e=>((e=Object.create(e)).children||(e.children=[]),Object.defineProperty(e,"exports",{enumerable:!0,set:()=>{throw new Error("ES Modules may not assign module.exports or exports.*, Use ESM export syntax, instead: "+e.id)}}),e),__webpack_require__.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),__webpack_require__(274)})();